1.	Hay que instalar WSL en Windows, en salas de Duoc esta instalado, pero en caso de que no lo este hay que ir a la terminal de Windows e instalarlo con:
wsl ‚Äìinstall
2.	Una vez ya tengamos WSL, hay que entrar a la terminal de WSL. En la misma terminal de Windows se puede entrar con solo escribir 
wsl
	(Recomiendo cambiar a user root para trabajar en este caso) 
		sudo -i
3.	Dentro de WSL, vamos a actualizar los repositorios para instalar Docker
apt update
apt install docker-cli
Una vez listo, creamos una red interna con Docker para que haya un orden y comunicaci√≥n entre contenedores.
docker network create jenkins-net

4.	Luego, empezamos con la creaci√≥n de contenedores 
a.	Jenkins
docker run -d \
  --name jenkins \
  --user root \
  --network jenkins-net \
  -p 8080:8080 -p 50000:50000 \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v jenkins_home:/var/jenkins_home \
  jenkins/jenkins:lts-jdk17






‚ÄÉ

b.	SonarQube
docker run -d \
  --name sonarqube \
  --network jenkins-net \
  -p 9000:9000 \
  sonarqube:lts-community


5.	Una vez creados los contenedores verificamos que los contenedores est√©n iniciados y corriendo.
docker ps        <- Muestra contendores corriendo.
docker ps -a     <- Muestra todos los contenedores.
	En caso de que no est√©n corriendo los contendores, se pueden iniciar con:
		docker start <nombre del contenedor>
6.	Ahora con todos los contendores listos, podemos entrar al servidor de Jenkins y SonarQube para empezar a trabajar. Primero, hay que conocer la IP de WSL.
ifconfig
	En caso de que no se encuentre el comando hay que instalar la herramienta.
		apt install net-tools
En el output de ifconfig hay que buscar la interfaz de red, en muchos casos es la interfaz de red: eth0
 
‚Ä¶








Con esta IP ya lista, podemos entrar a Jenkins en el navegador del computador.
		http://<< IP ETH0 >>:8080 
7.	Una vez dentro de la p√°gina, podemos iniciar con la contrase√±a inicial del usuario admin que podemos encontrar en los logs del contendor y en el directorio que nos especifica.
/var/jenkins_home/secrets/
Para poder navegar hasta el directorio, hay que entrar a la consola del contenedor de Jenkins desde WSL, esto se logra con el comando:
		docker exec -it jenkins bash
Ya dentro de la terminal de Jenkins podemos ver la contrase√±a con el comando:
root@46fe1396ea31:/# more /var/jenkins_home/secrets/initialAdminPassword

 
Obteniendo la contrase√±a, simplemente la copiamos y pegamos en la p√°gina.
8.	Cuando iniciemos nos pedir√° seleccionar que plugin instalar.
 
Se recomienda instalar los plugin sugeridos.














9.	Cuando est√©n instalados los plugin, nos pedir√° crear un usuario, se recomienda saltar esta secci√≥n y quedarse con admin 
 

Luego de eso, nos pedir√° configurar la URL de la instancia, hay que dejar la predeterminada simplemente. 
	Y listo, ya estamos en Jenkins.

10.	 Ahora instalaremos los plugin que necesitamos espec√≠ficamente para nuestro trabajo, en este caso son:
-	SonarQube Scanner for Jenkins.
-	OWASP Dependency-Check Plugin.
-	HTML Publisher plugin.
Iremos a la pesta√±a de ‚ÄúPlugin‚Äù en las configuraciones de Jenkins.
 



	Una vez en ‚ÄúPlugin‚Äù seleccionamos en ‚ÄúAvailable plugins‚Äù para buscarlos.
	 
	Y luego en ‚ÄúInstalled plugins‚Äù nos aseguramos que est√©n instalados.
11.	 Ahora que tenemos los Plugin necesarios, vamos a definir algunas credenciales (API Key y Token) necesarias para SonarQube y Dependency-Check. Para esto iremos a la secci√≥n de ‚ÄúCredentials‚Äù en las configuraciones.
 






Iremos a ‚ÄúAdd credentials‚Äù 
 
 
Tanto la credencial para SonarQube como para Dependency-Check ser√°n de tipo/kind Secret text.

Ya en ‚ÄúNew credentials‚Äù, vamos a agregar primero alguna de las dos necesarias. Partamos por SonarQube, en otra pesta√±a iremos a su p√°gina para conseguir una API Key (el contenedor tiene que estar iniciado)
	http://<< IP ETH0 >>:9000
 
Las credenciales por defecto son admin:admin, luego de iniciar nos pedir√° cambiar la contrase√±a por defecto, cualquiera sirve.
Una vez en el men√∫ de SonarQube vamos a ‚ÄúMy Account‚Äù.
 


Y luego en la secci√≥n de ‚ÄúSecurity‚Äù rellenamos el formulario de Tokens para obtener uno propio.
 
Ya con este podemos rellenar el formulario de Jenkins. (Recomiendo usar el mismo nombre de la imagen -> sonarQubeToken)
 
Y para la segunda credencial (Dependency-Check ‚Äì API Key) tendremos que ir a la p√°gina oficial de NVD. https://nvd.nist.gov/developers/request-an-api-key 
 
Cuando rellenemos el formulario este nos enviara un correo con el token para activar la API Key.
 
 

Ahora con esa API Key tendremos las credenciales necesarias.
 
12.	 Ahora como √∫ltimo, hay que definir las Tools y Sistema.
En la pantalla de ‚ÄúTools‚Äù, hay que definir instalaciones. 
(Recomiendo usar los mismos nombres que las im√°genes).
SonarQubeScanner.
 
Maven.
 
Dependency-Check.
 
JDK.
 
Y en la configuraci√≥n de ‚ÄúSystem‚Äù, buscamos la secci√≥n de SonarQube servers
 
13.	Ahora vamos a crear una nueva tarea en Jenkins, la tarea debe ser de tipo Pipeline. 
Luego en la configuracion de esa tarea, en la seccion ‚ÄúPipeline‚Äù vamos a la seccion de Script, y como definicion escogemos ‚ÄúPipeline script from SCM‚Äù en donde indicaremos la URL de nuestro repositorio con todo lo necesario.
 
Algo importante en esta secci√≥n es cambiar el nombre de la Branch de Github que usaremos, en mi caso es */main
 

Nota: Adjunto a este documento estar√°n los archivos necesarios para testear, los cuales deber√°n estar en un repositorio de Github p√∫blico. No olviden tambi√©n cambiar las variables declaradas en el Script de nombre ‚ÄòJenkinsfile‚Äô
 
Principalmente las variables SONARQUBE_TOKEN con el token obtenido anteriormente, y TARGET_URL con la IP de la maquina WSL junto al puerto 5000, que es en donde levantaremos la app vulnerable para testear.







14.	Ahora como √∫ltimo, debemos de levantar el servidor e iniciar la Pipeline.
En la terminal de WSL clonaremos el mismo repositorio que definimos en la Pipeline anteriormente.
	git clone <URL DE GIT>
 
Ahora vamos a instalar Flask para levantar el servidor vulnerable, para esto necesitamos crear un entorno aislado de Python, ya que Linux ‚Äúllora‚Äù si intentas instalar paquetes directamente con pip en el sistema.

apt-get update
apt-get install -y python3 python3-venv python3-pip
apt install python3.12-venv
python3 -m venv .venv
source .venv/bin/activate
 


Ahora con todo lo necesario y el servidor vulnerable funcionando podemos ejecutar el Pipeline. 
 
 
Entrando al Pipeline, en la secci√≥n de Builds se puede observar el progreso en tiempo real si vas a ‚ÄúConsole Output‚Äù.
 
‚Ä¶

Este proceso demorara su tiempo porque Jenkins est√° instalando programas (como python3, pip-audit, etc), actualizando la base de datos de vulnerabilidades que obtiene desde la NVD, y entre otros procesos...
 
Como una explicaci√≥n adicional mientras termina ese proceso: Sin la API Key de la NVD este proceso demorar√≠a 30 minutos aproximado, en cambio con API Key que solicitamos este proceso no demor√≥ ni 5 minutos‚Ä¶ Por otro lado, el token SQA nos sirve para poder utilizar SonarQube, sin el token nos lanzar√≠a un error y dependiendo de como este estructurado el script nos puede botar todo.
 
Ahora que termin√≥ y con un SUCCESS, podemos ver los resultados del Dependency-Check y pip-audit en el Workspace seleccionando el directorio que esta resaltado en azul.
  
 
Ya dentro de la ruta podemos descargar los contenidos, los informes se encuentran en la carpeta dependency-check-report.
 
Por √∫ltimo en el caso de SonarQube, tenemos que ir a la p√°gina del servidor SonarQube en el puerto 9000. http://<< IP ETH0 >>:9000
Ah√≠ estar√° nuestro resultado. üêà
 





